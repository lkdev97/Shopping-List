/*
 * This Java source file was generated by the Gradle 'init' task.
 */
package shopping.list;

import io.javalin.Javalin;


public class App {

    public static void main(String[] args) {
        Javalin app = Javalin.create()
            .sessionHandler(Session::fileSessionHandler)
            .enableStaticFiles("/public")
            .start(80);
        
        app.post("/listhtml", ctx -> {
            ctx.result(ListManager.addList(ctx.formParam("name")));
        });

        app.post("/close", ctx -> {
            int id = ListManager.splitId(ctx.formParam("id"));
            ListManager.removeList(id);
        });

        app.post("/article", ctx -> {
            int id = ListManager.splitId(ctx.formParam("id"));
            String name = ctx.formParam("name");
            ctx.result(ListManager.addArticle(id, name));
        });

        app.post("/save", ctx -> {
            int id = ListManager.splitId(ctx.formParam("id"));
            ctx.result(HTMLGenerator.getListOpenHTML(id, ctx.formParam("name")));
            ctx.sessionAttribute("list", ListManager.getArticlesById(id));
            ctx.sessionAttribute("id", id);
            ctx.sessionAttribute("name", ctx.formParam("name"));
        });
 
        app.post("/remove", ctx -> {
            ListManager.removeArticle(ListManager.splitId(ctx.formParam("id")), ctx.formParam("name"));
        });

        app.post("/open", ctx -> {
            ctx.result(HTMLGenerator.getListHTMLbyId(Integer.parseInt(ctx.formParam("id")), ctx.formParam("name")));
        });

        app.post("/load", ctx -> {
            try {
                ctx.result(ListManager.getListFromSession(ctx.sessionAttribute("list"), ctx.sessionAttribute("name"), ctx.sessionAttribute("id")));
            } catch(NullPointerException e) {
                System.out.println("Error "+ e);
            }
            ctx.req.getSession().invalidate();
        });
        
    }
    
}
